# GitHub Copilot / AI Agent Instructions for this repo

This repository is a personal Nix flake-based dotfiles collection. The goal of these notes is to help AI coding agents make small, correct changes (add packages, tweak configs, add app packaging) without breaking the flake outputs.

- **Big picture**: `flake.nix` (root) assembles NixOS + Home Manager outputs. `nixosConfigurations.laptop` composes `configuration.nix` + a Home Manager module that imports `home.nix` for the `omrih` user.
- **System vs Home**: system configuration lives in `configuration.nix`; user/home configuration is in `home.nix` and `home-manager` imports inside the flake.

- **Where to change things**:
  - Add global, system-level packages or services in `configuration.nix`.
  - Add per-user packages, programs, and shell aliases in `home.nix`.
  - Add app-specific Nix expressions under `apps/` (see `apps/fluxer.nix` for packaging pattern).
  - Desktop/window-manager configuration files live in `config/` (e.g. `config/hypr/hyprland.conf`). `home.nix` reads that file into Hyprland via `wayland.windowManager.hyprland.extraConfig`.

- **Common commands** (use these verbatim when rebuilding):
  - Rebuild the whole system (example host name used in the flake):
    - `sudo nixos-rebuild switch --flake .#laptop`
  - Rebuild Home Manager (if you need to iterate quickly on `home.nix`):
    - `home-manager switch --flake .#omrih` (the flake integrates home-manager; this is useful for user-only changes)
  - Update flake inputs: `nix flake update`
  - Open a development shell if provided by future flakes: `nix develop`

- **Conventions & patterns (concrete examples)**:
  - `apps/fluxer.nix` shows how AppImages are fetched and wrapped: use `pkgs.fetchurl`, `appimageTools.extract`, then `appimageTools.wrapType2` with `extraInstallCommands` and `extraBwrapArgs`.
  - `home.nix` demonstrates importing local app package stanzas with `let fluxer = import ./apps/fluxer.nix { inherit pkgs; };` and then adding `fluxer` to `home.packages`.
  - Hyprland integration: `home.nix` sets `wayland.windowManager.hyprland.extraConfig = builtins.readFile ./config/hypr/hyprland.conf`, so edits to that file are applied on next Home Manager/system switch.
  - VSCode packaging: `programs.vscode.package = pkgs.vscode.fhsWithPackages (ps: [...])` â€” use `fhsWithPackages` when the environment needs extra developer tools (clang, cmake, nixfmt, etc.).

- **What an agent should change vs not change**:
  - OK: Add a small package in `home.packages` or `environment.systemPackages`, add a module under `apps/` following `fluxer.nix` pattern, tweak `config/*` dotfiles.
  - Avoid: Arbitrary edits to `hardware-configuration.nix` unless explicitly requested (this is generated by `nixos-generate-config`). Avoid changing `system.stateVersion` without owner approval.

- **Dependencies & inputs**:
  - Flake inputs are declared in `flake.nix` (examples: `nixpkgs`, `home-manager`, `helium`, `catppuccin`). If a change needs a new input, update `flake.nix` and run `nix flake update`.

- **Debugging/iteration tips**:
  - For quick iteration on UI/WM tweaks, edit `config/hypr/hyprland.conf` and then run the relevant `home-manager` or `nixos-rebuild` command above.
  - If packaging fails: run `nix build .#packages.x86_64-linux.<name>` where `<name>` is the attribute used in `flake.nix` outputs (or build the flake's package path you added).

- **Examples to copy when making changes**:
  - Add an App under `apps/` by mirroring `apps/fluxer.nix` (fetch, extract, wrap). See `apps/fluxer.nix` for `extraInstallCommands` usage.
  - Add a user shell alias in `home.nix` under `programs.bash.shellAliases` (the repo already adds `nixos-switch` alias pointing at the flake path).

If anything in this file is unclear or you'd like more automation (e.g., a `Makefile` or `flake.nix` dev shell), tell me which workflows you'd like automated and I'll update this guidance and add the helper scripts.
